<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Bol√£o do Beb√™ üë∂</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f6f6f6;
  padding: 20px;
  display: flex;
  justify-content: center;
}
.card {
  background: #fff;
  max-width: 450px;
  width: 100%;
  padding: 20px;
  border-radius: 14px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}
h2,h4 { text-align: center; }

input,button {
  width: 100%;
  padding: 10px;
  margin-top: 8px;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 16px;
}

button { cursor:pointer; border:none; }

.menino { background:#cce5ff; }
.menina { background:#ffd6e7; }
.whatsapp { background:#25D366;color:white; }

button.ativo {
  box-shadow: 0 0 0 3px #333 inset;
  font-weight: bold;
}

.numeros {
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:6px;
  margin-top:10px;
}
.numero {
  background:#eee;
  padding:8px;
  text-align:center;
  border-radius:6px;
  cursor:pointer;
}
.numero.usado {
  background:#ccc;
  text-decoration:line-through;
  cursor:not-allowed;
}
.numero.selecionado {
  background:#8bc34a;
  color:white;
}

.pix {
  background:#f1f1f1;
  padding:10px;
  border-radius:8px;
  text-align:center;
}

.hidden { display:none; }
</style>
</head>

<body>
<div class="card">

<h2>Bol√£o do Beb√™ üë∂</h2>
<p style="text-align:center"><strong>R$ 5,00 por n√∫mero</strong></p>

<!-- ETAPA 1 -->
<div id="etapa1">
  <input id="nome" placeholder="Seu nome">

  <button class="menino" onclick="selecionarSexo('Menino üíô',this)">üíô Menino</button>
  <button class="menina" onclick="selecionarSexo('Menina üíñ',this)">üíñ Menina</button>

  <button onclick="irParaNumeros()">Avan√ßar</button>
</div>

<!-- ETAPA 2 -->
<div id="etapa2" class="hidden">
  <h4>Escolha seus n√∫meros</h4>
  <p id="loading" style="text-align:center">‚è≥ Carregando n√∫meros...</p>
  <div class="numeros" id="numeros"></div>
  <p id="total" style="text-align:center;font-weight:bold"></p>
  <button onclick="enviarPalpite()">Enviar palpite</button>
</div>


<!-- ETAPA 3 -->
<div id="etapa3" class="hidden">
  <div class="pix">
    <p style="font-size:16px;font-weight:bold">
      Favor realizar o Pix no valor total
    </p>

    <p id="resumoPix" style="margin:10px 0;font-size:15px"></p>

    <p style="font-weight:bold;font-size:18px">
      Total: <span id="valorPix"></span>
    </p>

    <input
      id="pixKey"
      name="pixKey"
      value="e7688ae4-2bae-4f90-847d-8f6702c2f5f3"
      readonly
    >

    <button onclick="copiarPix()">üìã Copiar chave Pix</button>
  </div>

  <button class="whatsapp" onclick="abrirWhatsApp()">
    Enviar comprovante no WhatsApp
  </button>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbzOqR9mIgX-riFXsQmJgSwUKavB-pIcyALm5nwC7VT2o11i1SbmCYKzzj3SuiTQ0S0nrw/exec";

let sexoSelecionado = "";
let numerosSelecionados = [];
const VALOR = 5;

function selecionarSexo(sexo, btn){
  sexoSelecionado = sexo;
  document.querySelectorAll(".menino,.menina").forEach(b=>b.classList.remove("ativo"));
  btn.classList.add("ativo");
}

function irParaNumeros(){
  if(!document.getElementById("nome").value || !sexoSelecionado){
    alert("Preencha tudo");
    return;
  }
  etapa1.style.display="none";
  etapa2.style.display="block";
  carregarNumeros();
}

function carregarNumeros(){
  const s=document.createElement("script");
  s.src=API+"?action=usados&callback=processarNumeros&t="+Date.now();
  document.body.appendChild(s);
}

function processarNumeros(data){
  loading.style.display="none";
  numeros.innerHTML="";
  for(let i=1;i<=200;i++){
    const d=document.createElement("div");
    d.className="numero";
    d.innerText=i;
    if(data.usados.includes(i)){
      d.classList.add("usado");
    }else{
      d.onclick=()=>selecionarNumero(d,i);
    }
    numeros.appendChild(d);
  }
}

function selecionarNumero(el,num){
  if(numerosSelecionados.includes(num)){
    numerosSelecionados=numerosSelecionados.filter(n=>n!==num);
    el.classList.remove("selecionado");
  }else{
    numerosSelecionados.push(num);
    el.classList.add("selecionado");
  }
  total.innerText=`Total: R$ ${numerosSelecionados.length*VALOR},00`;
}

function enviarPalpite() {
  const nome = document.getElementById("nome").value.trim();

  if (!nome || !sexoSelecionado || numerosSelecionados.length === 0) {
    alert("Preencha tudo");
    return;
  }

  // üëâ cria UM formul√°rio
  const form = document.createElement("form");
  form.method = "POST";
  form.action = API;
  form.target = "hidden_iframe";

  const campos = {
    nome: nome,
    sexo: sexoSelecionado,
    numeros: numerosSelecionados.join(",") // üî• ENVIA TODOS
  };

  for (const key in campos) {
    const input = document.createElement("input");
    input.type = "hidden";
    input.name = key;
    input.value = campos[key];
    form.appendChild(input);
  }

  document.body.appendChild(form);
  form.submit();
  document.body.removeChild(form);

  // üëâ PREENCHE TELA DO PIX
  const quantidade = numerosSelecionados.length;
  const valorTotal = quantidade * VALOR;

  document.getElementById("resumoPix").innerText =
    `${quantidade} n√∫mero(s) selecionado(s)`;

  document.getElementById("valorPix").innerText =
    `R$ ${valorTotal},00`;

  etapa2.style.display = "none";
  etapa3.style.display = "block";
}

function copiarPix() {
  const pix = document.getElementById("pixKey").value;
  navigator.clipboard.writeText(pix)
    .then(() => {
      alert("Chave Pix copiada com sucesso!");
    })
    .catch(() => {
      alert("Erro ao copiar a chave Pix");
    });
}

function abrirWhatsApp() {
  const nome = document.getElementById("nome").value.trim();
  const quantidade = numerosSelecionados.length;
  const valorTotal = quantidade * VALOR;
  const listaNumeros = numerosSelecionados.join(", ");

  const mensagem =
`Oi üòä
J√° fiz meu palpite no bol√£o do beb√™ üë∂

Nome: ${nome}
Palpite: ${sexoSelecionado}
N√∫meros: ${listaNumeros}
Total pago: R$ ${valorTotal},00

Vou enviar o comprovante do Pix.`;

  window.open(
    "https://wa.me/5548984065039?text=" + encodeURIComponent(mensagem),
    "_blank"
  );
}

window.processarNumeros = processarNumeros;
</script>

<iframe name="hidden_iframe" style="display:none"></iframe>
</body>
</html>
